shader_type canvas_item;

// === [ æ¶æ„å¸ˆå‚æ•°é¢æ¿ ] ===
// å½“å‰ä¿¡ä½¿çš„ä½ç½®è¿›åº¦ (ç”± GDScript æ¯å¸§æŠ•å–‚)
uniform float current_progress : hint_range(0.0, 1.0) = 0.0;
// æœªæ¥çš„è§å…‰è‰² (ä½ åœ¨ç¼–è¾‘å™¨é‡Œè°ƒè¿™ä¸ªå°±è¡Œ)
uniform vec4 future_color : source_color = vec4(0.0, 0.8, 1.0, 0.3);
// è£å‰ªè¾¹ç¼˜æŸ”å’Œåº¦ (ç¨å¾®ç»™ç‚¹æ¸å˜ï¼Œåˆ«è®©çº¿æ®µçœ‹èµ·æ¥åƒè¢«ç‹—å•ƒäº†ä¸€æ · ğŸ¶)
uniform float edge_softness : hint_range(0.0, 0.05) = 0.01;

void fragment() {
    if (current_progress > UV.x) {
		discard;
	}
    float visibility = smoothstep(current_progress, current_progress + edge_softness, UV.x);
    
    // 2. è¾¹ç¼˜ç¾½åŒ–ï¼šä¿ç•™â€œæ·¡æ·¡çš„è§å…‰â€è´¨æ„Ÿï¼Œä¸­é—´äº®ä¸¤è¾¹æš—
    // è¿˜æ˜¯é‚£ä¸ªé…æ–¹ï¼šç”¨ UV.y æŠŠçº¿çš„ä¸¤è¾¹ç¼˜å˜æš—
    float core_intensity = 1.0 - abs(UV.y - 0.5) * 2.0;
    core_intensity = pow(core_intensity, 1.5); // åŠ ç‚¹æŒ‡æ•°è®©å‘å…‰æ›´èšæ‹¢
    
    // 3. è¾“å‡ºåˆå¹¶
    COLOR = future_color;
    COLOR.a *= visibility * core_intensity;
}