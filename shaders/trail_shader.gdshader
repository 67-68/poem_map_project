shader_type canvas_item;

// --- ç¬”è§¦æ§åˆ¶ ---
uniform float ink_roughness : hint_range(0.0, 5.0) = 1.0;  // è¾¹ç¼˜æŠ–åŠ¨å¼ºåº¦
uniform float dry_brush : hint_range(0.0, 1.0) = 0.5;      // æ¯ç¬”ç¨‹åº¦
uniform sampler2D noise_tex : hint_default_white;
uniform float noise_freq = 50.0; 

void fragment() {
	// 1. ä¿®æ­£ UV é‡‡æ ·ï¼šä¸ºäº†é˜²æ­¢é•¿è·¯å¾„æ‹‰ä¼¸ï¼Œé‡‡æ ·æ—¶åº”è€ƒè™‘çº¹ç†çš„é•¿å®½æ¯”
	// åœ¨ Line2D ä¸­ï¼Œé€šå¸¸ç›´æ¥ç”¨ UV é…åˆè¾ƒå¤§çš„ noise_freq å³å¯
	vec2 noise_uv = UV * noise_freq + TIME * 0.05;
	float n = texture(noise_tex, noise_uv).r;
	
	// 2. äº§ç”ŸæŠ–åŠ¨æ•ˆæœ
	// æˆ‘ä»¬ä¸å†é‡‡æ · index_mapï¼ˆå› ä¸º Line2D æ¸²æŸ“æ—¶æ²¡æœ‰å®ƒï¼‰ï¼Œ
	// æˆ‘ä»¬åˆ©ç”¨ Line2D è‡ªèº«çš„è¾¹ç¼˜ (UV.y æ˜¯ 0.0 å’Œ 1.0)
	float edge_dist = abs(UV.y - 0.5) * 2.0; // 0 æ˜¯ä¸­å¿ƒï¼Œ1 æ˜¯è¾¹ç¼˜
	
	// ç”¨å™ªå£°æ‰°åŠ¨è¾¹ç¼˜åˆ¤å®š
	float edge_noise = (n - 0.5) * 0.2 * ink_roughness;
	// é¡ºç€å†™ smoothstep (ä»å°åˆ°å¤§)ï¼Œç„¶åç”¨ 1.0 å»å‡å®ƒæ¥å®ç°åè½¬ï¼
	// è¿™æ ·ä½ çš„ä»£ç æ‰å¯ä»¥åœ¨ä»»ä½•ç ´çƒ‚æ˜¾å¡ä¸Šç¨³å®šè¿è¡Œ ğŸ¤“â˜ï¸
	float ink_mask = 1.0 - smoothstep(0.7 + edge_noise, 0.9 + edge_noise, edge_dist);
	
	// 3. æ¯ç¬”æ•ˆæœï¼šæ ¹æ®å™ªå£°åˆ‡å¼€å†…éƒ¨åƒç´ 
	float dry_mask = smoothstep(dry_brush, dry_brush + 0.3, n);
	
	// 4. ã€å…³é”®ä¿®å¤ã€‘ç»“åˆ Gradient é¢œè‰²
	// COLOR å˜é‡åŒ…å«äº† Line2D çš„ Gradient é¢œè‰²å’Œ Width Curve çš„é€æ˜åº¦å½±å“
	vec4 final_color = COLOR; 
	
	// åº”ç”¨æˆ‘ä»¬çš„å¢¨è¿¹é®ç½©
	final_color.a *= ink_mask * dry_mask;
	
	COLOR = final_color;
}