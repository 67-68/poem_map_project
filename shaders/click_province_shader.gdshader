shader_type canvas_item;

// ã€æ ¸å¿ƒä¿®æ”¹ã€‘é€šè¿‡ hint å¼ºåˆ¶ç¦ç”¨è¿‡æ»¤å’Œé‡å¤ï¼Œè¿™æ¯”åœ¨ UI é‡Œæ‰¾åŠå¤©æœ‰æ•ˆå¾—å¤š
uniform sampler2D index_map : hint_default_black, filter_nearest, repeat_disable;
uniform sampler2D paper_index : source_color, filter_linear, repeat_enable; // å®£çº¸å¯ä»¥æ¨¡ç³Šç‚¹
uniform vec4 selected_id_color; // CPUä¼ è¿‡æ¥çš„å·é¢œè‰²
uniform float highligh_strength: hint_range(0.0,1,0) = 0.3;

uniform sampler2D height_map;
uniform float height_scale;

void vertex() {
    float h = texture(height_map, UV).r;
    VERTEX.y -= h * height_scale;
}

void fragment() {
	vec4 base_color = texture(TEXTURE, UV);
	
	vec4 paper = texture(paper_index, UV);

	vec4 current_id = texture(index_map,UV);

	vec3 diff = abs(current_id.rgb - selected_id_color.rgb);
    float threshold = 0.01; // ç¨å¾®æ”¾å®½ä¸€ç‚¹ï¼Œåˆ«é‚£ä¹ˆæ­»æ¿ ğŸ˜¡
    
    float is_selected = 0.0;
    if (diff.r < threshold && diff.g < threshold && diff.b < threshold) {
        is_selected = 1.0;
    }

	vec4 final_output = mix(paper,base_color, 0.8);
	vec4 highlight_tint = vec4(0.8,0.6,0.2,1.0);
	final_output = mix(final_output, highlight_tint, is_selected * highligh_strength);
	COLOR = final_output;
}